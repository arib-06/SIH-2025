<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap"
    rel="stylesheet" />
  <title>AI Assistant - Traverz Travel Companion</title>
  <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Custom CSS Files -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/ai-assistant.css') }}">
  <!-- CSS styles moved to external files -->
  <!-- Navbar Loader Script -->
  <script src="{{ url_for('static', filename='js/navbar-loader.js') }}"></script>
  <!-- AI Assistant functionality -->
  <script src="{{ url_for('static', filename='js/ai-assistant.js') }}"></script>

</head>

<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen">
  <!-- Navigation Container - Will be populated by navbar-loader.js -->
  <div id="navbar-container"></div>

  <!-- Main Chat Section -->
  <section class="pt-24 pb-8 px-4 sm:px-6 lg:px-8 min-h-screen ">
    <div class="max-w-6xl mx-auto">
      <!-- Page Header -->
      

      <!-- Chat Interface -->
      <div class="glass-effect rounded-3xl shadow-2xl animate-fadeInUp">
        <!-- Chat Header -->
        <div class="flex items-center justify-between p-6 border-b border-slate-200">
          <div class="flex items-center space-x-4">
            <div class="w-14 h-14 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center animate-pulse-slow">
              <svg class="w-8 h-8 text-black" fill="currentColor" viewBox="0 0 256 256">
                <path d="M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128ZM84,116a12,12,0,1,0,12,12A12,12,0,0,0,84,116Zm88,0a12,12,0,1,0,12,12A12,12,0,0,0,172,116Zm60,12A104,104,0,0,1,79.12,219.82L45.07,231.17a16,16,0,0,1-20.24-20.24l11.35-34.05A104,104,0,1,1,232,128Zm-16,0A88,88,0,1,0,51.81,172.06a8,8,0,0,1,.66,6.54L40,216,77.4,203.53a7.85,7.85,0,0,1,2.53-.42,8,8,0,0,1,4,1.08A88,88,0,0,0,216,128Z"></path>
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-semibold">Traverz AI Assistant</h2>
              <p class="text-sm text-green-600 flex items-center">
                <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                Online & Ready to Help
              </p>
            </div>
          </div>
          <div class="flex items-center space-x-3">
            <button class="p-3 rounded-xl hover:bg-slate-100 transition-colors" onclick="clearChat()" title="Clear Chat">
              <svg class="w-5 h-5 text-slate-500" fill="currentColor" viewBox="0 0 256 256">
                <path d="M216,48H176V40a24,24,0,0,0-24-24H104A24,24,0,0,0,80,40v8H40a8,8,0,0,0,0,16h8V208a16,16,0,0,0,16,16H192a16,16,0,0,0,16-16V64h8a8,8,0,0,0,0-16ZM112,168a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm48,0a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm0-120H96V40a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8Z"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container p-6">
          <!-- Chat Messages -->
          <div class="chat-messages space-y-4" id="chatMessages">
            <!-- Welcome Message -->
            <div class="ai-message p-5 animate-messageSlideIn">
              <div class="flex items-center space-x-3 mb-3">
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                  <svg class="w-4 h-4 text-black" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128Z"></path>
                  </svg>
                </div>
                <span class="text-sm text-slate-500 font-medium">AI Assistant</span>
                <span class="text-xs text-slate-400">Just now</span>
              </div>
              <div class="message-content text-slate-700">
                <p class="mb-4">üëã <strong>Welcome to Traverz AI Assistant!</strong></p>
                <p class="mb-4">I'm here to help you plan amazing trips and answer any travel questions. I can assist with:</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm mb-4">
                  <div class="flex items-center space-x-3 p-3 bg-blue-50 rounded-lg">
                    <span class="text-lg">‚úàÔ∏è</span>
                    <span>Flight & hotel bookings</span>
                  </div>
                  <div class="flex items-center space-x-3 p-3 bg-purple-50 rounded-lg">
                    <span class="text-lg">üó∫Ô∏è</span>
                    <span>Trip planning & itineraries</span>
                  </div>
                  <div class="flex items-center space-x-3 p-3 bg-green-50 rounded-lg">
                    <span class="text-lg">üìç</span>
                    <span>Local recommendations</span>
                  </div>
                  <div class="flex items-center space-x-3 p-3 bg-orange-50 rounded-lg">
                    <span class="text-lg">üÜò</span>
                    <span>Emergency support</span>
                  </div>
                </div>
                <p><strong>What would you like to know about your next adventure?</strong></p>
                <div class="quick-actions">
                  <button class="quick-action-btn" onclick="sendQuickMessage('Plan a 5-day trip to Paris')">Plan Paris Trip</button>
                  <button class="quick-action-btn" onclick="sendQuickMessage('Find budget hotels in Tokyo')">Find Hotels</button>
                  <button class="quick-action-btn" onclick="sendQuickMessage('Best time to visit Bali')">Travel Tips</button>
                  <button class="quick-action-btn" onclick="sendQuickMessage('Emergency contacts for Thailand')">Emergency Info</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Chat Input Area -->
          <div class="mt-6 pt-6 border-t border-slate-200">
            <div class="flex space-x-4">
              <div class="flex-1 relative">
                <textarea 
                  id="chatInput"
                  placeholder="Ask me anything about travel... (Press Shift+Enter for new line, Enter to send)"
                  class="chat-input w-full p-4 pr-16 border-2 border-slate-300 rounded-2xl focus:outline-none resize-none"
                  rows="1"
                  onkeydown="handleKeyPress(event)"
                  oninput="autoResize(this)"
                ></textarea>
                <div class="absolute right-3 bottom-3 flex space-x-2">
                  <button 
                    class="p-2 rounded-lg hover:bg-slate-100 transition-colors"
                    onclick="attachFile()"
                    title="Attach File"
                  >
                    <svg class="w-5 h-5 text-slate-500" fill="currentColor" viewBox="0 0 256 256">
                      <path d="M209.66,122.34a8,8,0,0,1,0,11.32l-82.05,82a56,56,0,0,1-79.2-79.21L147.67,35.27a40,40,0,1,1,56.61,56.55L105,193a24,24,0,0,1-33.94-33.94l83.28-83.29a8,8,0,0,1,11.32,11.32L82.34,170.34a8,8,0,0,0,11.32,11.32L192.93,80.61a24,24,0,0,0-33.94-33.94L60.73,147.85a40,40,0,0,0,56.55,56.61l82.06-82A8,8,0,0,1,209.66,122.34Z"></path>
                    </svg>
                  </button>
                </div>
              </div>
              <button 
                id="sendButton"
                class="btn-primary px-8 py-4 rounded-2xl text-black font-semibold hover:scale-105 transition-all duration-300" 
                onclick="sendMessage()"
              >
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M231.4,44.34s0,0,0,0a8.32,8.32,0,0,0-8.81-1.74L33.12,106.3a16,16,0,0,0,.09,29.42L120,150.15l14.43,86.79a16,16,0,0,0,29.42.09L227.57,47.57A8.32,8.32,0,0,0,231.4,44.34ZM120,134.85,54.28,119.18,200.75,62.52Zm45.05,86.8L149.32,155.91,206,90.19Z"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <script type="module" src="{{ url_for('static', filename='js/ai.js') }}"></script>
  <script>
    let isTyping = false;
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');

    function handleKeyPress(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
    }

    function sendMessage() {
      const message = chatInput.value.trim();
      if (!message || isTyping) return;

      // Add user message
      addMessage(message, 'user');
      chatInput.value = '';
      chatInput.style.height = 'auto';

      // Show typing indicator
      showTypingIndicator();

      // Simulate AI response delay
      setTimeout(async() => {
        hideTypingIndicator();
        const response = await generateAIResponse(message);
        addMessage(response, 'ai');
      }, 1500 + Math.random() * 1000);
    }

    function sendQuickMessage(message) {
      chatInput.value = message;
      sendMessage();
    }

   function addMessage(text, sender) {
  const messageDiv = document.createElement('div');
  messageDiv.className = `message-bubble ${sender}-message p-5 animate-messageSlideIn flex flex-col`;

  const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

  if (sender === 'user') {
    messageDiv.innerHTML = `
      <div class="message-content text-black mb-2">
        <p>${text}</p>
      </div>
      <div class="flex items-center justify-start space-x-3 mt-1">
    <span class="text-xs text-black/70 font-medium">10:41 PM</span>
    <span class="text-xs text-black/70 font-medium">You</span>
    
  </div>

</div>
    `;
  } else {
    messageDiv.innerHTML = `
      <div class="flex flex-row items-center space-x-3 mb-2 w-full">
        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
          <svg class="w-4 h-4 text-black" fill="currentColor" viewBox="0 0 256 256">
            <path d="M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128Z"></path>
          </svg>
        </div>
        <span class="text-sm text-slate-500 font-medium">AI Assistant</span>
        <span class="text-xs text-slate-400">${timestamp}</span>
      </div>
      <div class="message-content text-slate-700">
        ${formatAIResponse(text)}
      </div>
    `;
  }

  chatMessages.appendChild(messageDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}


    function formatAIResponse(text) {
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/\n/g, '<br>')
        .replace(/‚Ä¢/g, '<span class="text-blue-600 font-bold">‚Ä¢</span>');
    }

    function showTypingIndicator() {
      isTyping = true;
      const typingDiv = document.createElement('div');
      typingDiv.id = 'typing-indicator';
      typingDiv.className = 'typing-indicator animate-messageSlideIn';
      typingDiv.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      `;
      chatMessages.appendChild(typingDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function hideTypingIndicator() {
      const typingDiv = document.getElementById('typing-indicator');
      if (typingDiv) {
        typingDiv.remove();
      }
      isTyping = false;
    }

    function clearChat() {
      chatMessages.innerHTML = `
        <div class="ai-message p-5 animate-messageSlideIn">
          <div class="flex flex-row items-center space-x-3 mb-3 w-full">

            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
              <svg class="w-4 h-4 text-black" fill="currentColor" viewBox="0 0 256 256">
                <path d="M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128Z"></path>
              </svg>
            </div>
            <span class="text-sm text-slate-500 font-medium">AI Assistant</span>
            <span class="text-xs text-slate-400">Just now</span>
          </div>
          <div class="message-content text-slate-700">
            <p><strong>Chat cleared!</strong> üßπ</p>
            <p class="mt-2">I'm ready to help with your next travel question. What adventure are you planning?</p>
            <div class="quick-actions">
              <button class="quick-action-btn" onclick="sendQuickMessage('Plan a weekend getaway')">Weekend Trip</button>
              <button class="quick-action-btn" onclick="sendQuickMessage('Best travel apps')">Travel Apps</button>
              <button class="quick-action-btn" onclick="sendQuickMessage('Packing checklist')">Packing Tips</button>
            </div>
          </div>
        </div>
      `;
    }

    function attachFile() {
      // Simulate file attachment
      const fileTypes = [
        { icon: 'üì∏', text: 'Photo uploaded: destination-image.jpg', response: 'I can see your photo! This looks like a beautiful destination. Let me help you plan activities and find the best spots nearby. What specific experiences are you looking for at this location?' },
        { icon: 'üìÑ', text: 'Document attached: travel-itinerary.pdf', response: 'Thanks for sharing your itinerary! I\'ve analyzed your travel plans and can suggest optimizations, additional activities, and local insights for each destination. Would you like me to review any specific part of your trip?' },
        { icon: 'üó∫Ô∏è', text: 'Map shared: trip-route.png', response: 'Great map! I can see your planned route and suggest the best stops along the way, scenic viewpoints, local restaurants, and hidden gems. I can also help optimize your travel times and suggest alternative routes if needed.' }
      ];
      
      const randomFile = fileTypes[Math.floor(Math.random() * fileTypes.length)];
      
      addMessage(`${randomFile.icon} ${randomFile.text}`, 'user');
      
      setTimeout(() => {
        addMessage(randomFile.response, 'ai');
      }, 1500);
    }

    // Auto-focus chat input when page loads
    window.addEventListener('load', function() {
      setTimeout(() => {
        chatInput.focus();
      }, 800);
    });

    // Navbar scroll effect
    window.addEventListener('scroll', function() {
      const nav = document.querySelector('nav');
      if (window.scrollY > 50) {
        nav.style.background = 'rgba(255, 255, 255, 0.98)';
        nav.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.1)';
      } else {
        nav.style.background = 'rgba(255, 255, 255, 0.95)';
        nav.style.boxShadow = 'none';
      }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      // Ctrl/Cmd + K to focus chat
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        chatInput.focus();
      }
      
      // Escape to clear input
      if (e.key === 'Escape' && document.activeElement === chatInput) {
        chatInput.value = '';
        autoResize(chatInput);
      }
    });
  </script>
</body>

</html>